---
title: '布萊特灣球員樣本：播放速率調節器
description: '在本主題中，您將學習如何向 Brightcove Player 控制欄添加播放速率按鈕，並在您切換播放速度時使用中間件正確顯示當前時間和視頻時長。'
parent: Code Samples
---
 <h1>{{ page.title }}</h1>
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

  <section class="bcls-section">
    <h2 id="Player_example">播放器示例</h2>
    <!-- UPDATE description -->
    
    <aside class="bcls-aside bcls-aside--information">提供此示例和相關代碼作為生產開發的指南。該代碼未經認證可用於生產用途，也未經官方支持。</aside>
    <p>開始視頻播放，然後選擇控制欄中的播放速率按鈕（默認為1x）。選擇不同的速率以查看視頻播放速度如何變化。請注意，當您更改播放速率時，將根據所選的速率重新計算顯示的持續時間。</p>
    <!-- <aside class="bcls-aside bcls-aside--tip">If you don't want to code the middleware functions, you can use a plug and play solution. For details, see the  <a href="#Code_in_a_separate_JavaScript_file">Code in a separate JavaScript file</a> section.</aside> --><!-- UPDATE codepen here -->
    
    <p data-height="490" data-theme-id="34967" data-slug-hash="aGEVYZ" data-default-tab="result" data-user="bcls1969" data-embed-version="2" data-pen-title="Playback Rate Adjuster" class="codepen">看筆<a href="https://codepen.io/team/bcls1969/pen/aGEVYZ/">播放速率調節器</a>通過Brightcove學習服務（<a href="https://codepen.io/team/rcrooks1969"> @ bcls1969</a>） 上<a href="https://codepen.io">密碼筆</a>。</p>
    <script async src="https://static.codepen.io/assets/embed/ei.js"></script><!-- UPDATE link to GitHub source -->
    
    <h3>源代碼</h3>
          <p>觀看<a href="https://github.com/BrightcoveLearning/18597-playback-rate-adjuster">GitHub上的完整解決方案</a>。</p>
  </section>
  <section class="bcls-section">
    <details>
      <summary><h2 id="Using_the_CodePen">使用代碼筆</h2></summary>
      <p>以下是一些有效使用上述 CodePen 的提示：</p>
      <ul>
        <li>通過單擊切換播放器的實際顯示<strong translate="No">結果</strong>按鈕。</li>
        <li>點擊<strong translate="No">HTML/CSS/JS</strong>按鈕以顯示其中一種代碼類型。</li>
        <li>在本文檔的後面部分，應用程序中使用的邏輯、流程和样式將在<a href="#Player/HTML_configuration">播放器/HTML 配置</a> , <a href="#Application_flow">申請流程</a>和<a href="#Application_styling">應用樣式</a>部分。遵循這些部分中的信息的最佳方法是：
          <ol>
            <li>點擊<strong translate="No">在 CODEPEN 上編輯</strong> CodePen 中的按鈕，並在一個瀏覽器/瀏覽器選項卡中提供代碼。</li>
            <li>在CodePen中，調整要顯示的代碼。您可以在CodePen中更改不同代碼段的寬度。</li>
            <li>觀看<a href="#Player/HTML_configuration">播放器/ HTML配置</a>，<a href="#Application_flow">申請流程</a>和/或<a href="#Application_styling">應用程式樣式</a>其他瀏覽器/瀏覽器標籤中的部分。現在，您將能夠按照代碼說明進行操作，同時查看代碼。</li>
          </ol>
        </li>
      </ul>
    </details>
  </section>
  <section class="bcls-section">
    <details>
      <summary><h2 id="Development_sequence">開發順序</h2></summary> 
      <p>這是推薦的開發順序：</p>
      <ol>
        <li>使用頁內嵌入播放器實現來測試播放器，插件和CSS的功能（如果需要CSS）</li>
        <li>將插件的JavaScript和CSS放入單獨的文件中以進行本地測試</li>
        <li>解決任何錯誤後，將插件代碼和CSS部署到服務器上</li>
        <li>使用Studio將插件和CSS添加到播放器</li>
        <li>如果您確定iframe實現更合適，請替換頁內嵌入播放器實現（在下一部分中詳細介紹）</li>
      </ol>
      <p>有關這些步驟的詳細信息，請查看<a href="/coding-topics/step-step-plugin-development.html">一步步：插件開發</a>指導。</p>
      <h3>iframe或頁內嵌入</h3>
      <p>在開發Brightcove Player的增強功能時，您需要確定代碼是否最適合iframe或頁內嵌入實施。最佳實踐建議是構建一個可與iframe實現配合使用的插件。使用iframe播放器的優點是：</p>
      <ul>
        <li>與現有的JavaScript和/或CSS無衝突</li>
        <li>自動響應</li>
        <li>iframe可簡化在社交媒體應用中的使用（或需要將視頻“傳播"到其他應用中的任何時候）</li>
      </ul>
      <p>儘管集成頁內嵌入播放器可能會更加複雜，但是有時您會圍繞該實現計劃代碼。概括地說，當包含頁面需要與播放器進行通信時，這種方法是最好的。具體來說，以下是一些示例：</p>
      <ul>
        <li>包含頁面中的代碼需要偵聽播放器事件並對其進行操作</li>
        <li>播放器使用包含頁面中的樣式</li>
        <li>iframe將導致應用邏輯失敗，例如從包含頁面的重定向</li>
      </ul>
      <p>即使最終實現未使用iframe代碼，您仍可以將頁內嵌入代碼與JavaScript插件和CSS單獨文件一起使用。這封裝了你的邏輯，以便您可以輕鬆地在多個玩家中使用它。</p>
    </details>
  </section>
  <section class="bcls-section">
    <h2 id="Middleware_functions">中間件功能</h2>
    <p>本示例使用Video.js中間件來實現代碼解決方案。在很高的層次上，中間件最有價值的用例是您想攔截和更改播放器的核心行為，例如設置源或當前時間。通常，在本文檔中沒有詳細討論Video.js中間件，但將解釋用於中間件功能的實際代碼。以下是Video.js來源的文檔，其中詳細介紹了中間件：</p>
    <ul>
      <li><a href="http://docs.videojs.com/tutorial-middleware.html">中間件（來自Video.js文檔集）</a></li>
      <li><a href="http://blog.videojs.com/feature-spotlight-middleware/">功能亮點：中間件（來自Video.js博客）</a></li>
      <li><a href="https://github.com/videojs/videojs-playbackrate-adjuster">videojs-playbackrate-adjuster（示例應用程序）</a></li>
    </ul>
    <h3>使用Brightcove Player實施中間件功能</h3>
    <p>使用中間件功能的最簡單方法是：</p>
    <ol class="bcls-tasklist__restart">
      <li>編寫中間件功能。</li>
      <li>將中間件功能放置在頁面上，並將播放器放在<code translate="No">script</code>標籤，或使用<code translate="No">src</code>具有一個屬性<code translate="No">script</code>標籤。兩種實現方式都將在本文檔中顯示。</li>
      <li>使用<code translate="No">use()</code>方法，如下所示：
        <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.use('mimeType', functionName);</code></pre>
        <p>為了<strong>模仿類型</strong>您可以使用標準的視頻 mimetype，例如<strong>視頻/mp4</strong>，或使用<strong>*</strong>如果您希望中間件功能作用於所有 mimetype。</p>
        <aside class="bcls-aside bcls-aside--tip">插件和中間件可以設置為在包含它們的腳本時自動註冊。在這種情況下，您不需要使用<code translate="No">videojs.use()</code>方法。
      </li>
    </ol>
  </section>
  <section class="bcls-section">
    <h2 id="API/Plugin_resources_used">使用的API /插件資源</h2>
    <!-- UPDATE table, remove unneeded columns -->
    
    <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th>API類</th>
          <th>API方法</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><a href="https://docs.brightcove.com/brightcove-player/current-release/ControlBar.html">控制欄</a></td>
          <td><a href="https://docs.brightcove.com/brightcove-player/current-release/ControlBar.html#addChild">controlBar.addChild（）</a></td>
        </tr>
        <tr>
          <td><a href="https://docs.brightcove.com/brightcove-player/current-release/PlaybackRateMenuButton.html">PlaybackRateMenuButton</a></td>
          <td>&nbsp;</td>
        </tr>
      </tbody>
    </table>
  </section>
  <!-- UPDATE player and HTML configuration -->
  
  <section class="bcls-section">
    <h2 id="Player/HTML_configuration">播放器/ HTML配置</h2>
    <p>本節詳細介紹了播放器創建過程中所需的任何特殊配置。此外，還介紹了除頁面內嵌入播放器實現代碼外，還必須添加到頁面的其他HTML元素。</p>
    <h3>播放程式組態</h3>
    <p>您為此示例創建的Brightcove Player不需要任何特殊配置。</p>
    <h3>其他HTML</h3>
    <p>記得添加<code translate="No">id</code>歸因於<code translate="No">video</code>標籤在播放器中嵌入代碼。</p>
    <pre>
<code class="language-html" translate="No">&lt;video-js <span class="bcls-highlight">id="myPlayerID"</span>
...</code></pre>
  </section>
  <!-- UPDATE application flow -->
  
  <section class="bcls-section">
    <h2 id="Application_flow">申請流程</h2>
    <p>此應用程序背後的基本邏輯是：</p>
    <ul>
      <li>定義中間件功能</li>
      <li>向播放器註冊中間件</li>
      <li>定義播放速率選項</li>
      <li>初始化播放速率按鈕</li>
    </ul>
    <!-- UPDATE task 1 -->
    
    <h3>定義中間件功能</h3>
    <p>找到標有以下代碼的代碼：</p>
    <pre>
<code class="language-javascript" translate="No">// +++ Define the middleware functions +++</code></pre>
    <p>創建以下中間件功能：</p>
    <ol class="bcls-tasklist__restart">
      <li>創建支持的中間件功能，該功能將根據所選的播放速率重新計算播放的開始和結束時間。</li>
      <li>
        <p>創建一個中間件功能，該功能將在搜索時更新開始時間，持續時間甚至當前時間。</p>
        <p>創建中間件功能的基本語法如下：</p>
        <pre class="line-numbers">
<code class="language-javascript" translate="No">const playbackrateAdjuster = function(player) {
   return {
   ...
 };</code></pre>
        <p>請注意，<code translate="No">player</code>對像傳遞給函數。</p>
        <p>該中間件功能執行以下操作：</p>
        <ol>
          <li><strong>收聽ratechange事件</strong>：更改播放速率後，觸發<code translate="No">durationchange</code>和<code translate="No">timeupdate</code>事件。</li>
          <br />
          <li><strong>實現setSource（）方法</strong>：這是每個中間件功能必需的方法。通過使用所示語法，無論視頻類型如何，都將始終選擇中間件：
            <pre>
<code class="language-javascript" translate="No">setSource(srcObj, next) {
  next(null, srcObj);
},</code></pre>
          </li>
          <br />
          <li><strong>使用當前播放速率的覆蓋方法</strong>：覆蓋用於的方法<code translate="No">duration</code>，<code translate="No">currentTime</code>，<code translate="No">buffered</code>，<code translate="No">seekable</code>和<code translate="No">played</code>使用當前播放速率計算出的值。</li>
        </ol>
      </li>
    </ol>
    <!-- UPDATE task 5 -->
    
    <h3>向播放器註冊中間件</h3>
    <p>找到標有以下代碼的代碼：</p>
    <pre>
<code class="language-javascript" translate="No">// +++ Register the middleware with the player +++</code></pre>
    <p>使用<code translate="No">use()</code>方法。</p>
    <!-- UPDATE task 6 -->
    
    <h3>定義播放速率選項</h3>
    <p>找到標有以下代碼的代碼：</p>
    <pre>
<code class="language-javascript" translate="No">// +++ Define the playback rate options +++</code></pre>
    <p>定義要在播放速率菜單按鈕中顯示的播放速率。</p>
    <!-- UPDATE task 7 -->
    
    <h3>初始化播放速率按鈕</h3>
    <p>找到標有以下代碼的代碼：</p>
    <pre>
<code class="language-javascript" translate="No">// +++ Initialize the playback rate button +++</code></pre>
    <p>將播放速率菜單按鈕添加到播放器控制欄，然後使用options對像中指定的值對其進行初始化。</p>
  </section>
  <!-- UPDATE CSS description -->
  
  <section class="bcls-section">
    <h2 id="Application_styling">應用程式樣式</h2>
    <p>此示例沒有其他樣式。</p>
  </section>
  <section class="bcls-section">
    <h2 id="Using_the_middleware_function">使用中間件功能</h2>
    <p>一旦編寫了中間件功能，您就想使用它。前面提到了兩種方法，現在將對其進行詳細說明。</p>
    <h3>與播放器在同一頁面上的代碼</h3>
    <p>在此處，您可以在與播放器相同的頁面上定義中間件功能，然後進行註冊。這<a href="#Player_example">播放器示例</a>上面的Codepen中使用此方法。</p>
    <h3 id="Code_in_a_separate_JavaScript_file">單獨的JavaScript文件中的代碼</h3>
    <p>在以下代碼中，用於中間件功能的JavaScript和<code translate="No">use()</code>註冊方法僅包含在頁面中。</p>
    <pre class="line-numbers">
<code class="language-html" translate="No">&lt;video-js id="myPlayerID"
	  data-video-id="5604123528001"
	  data-account="1752604059001"
	  data-player="default"
	  data-embed="default"
	  data-application-id
	  class="video-js"
	  width="640" height="360"
	  controls muted&gt;&lt;/video&gt;
	&lt;script src="https://players.brightcove.net/1752604059001/default_default/index.min.js"&gt;&lt;/script&gt;

  &lt;!-- Include the rate adjuster middleware functions --&gt;
  &lt;script src="rate-adjuster.js"&gt;&lt;/script&gt;

  &lt;script type="text/javascript"&gt;
  	videojs.getPlayer("myPlayerID").ready(function(){
  		// When the player is ready, get a reference to it
  		var myPlayer = this;
  		console.log("myPlayer",myPlayer)
  		// Define the playback rate options
  		options = {"playbackRates":[0.5, 1, 1.5, 2, 4]};
  		// Initialize the playback rate button
  		myPlayer.controlBar.playbackRateMenuButton = myPlayer.controlBar.addChild('PlaybackRateMenuButton', {
      	playbackRates: options.playbackRates
  	  });
    });
  &lt;/script&gt;</code></pre>
    <p>本示例假定您將在自己的服務器上託管JavaScript文件。有關完整的代碼，請參見<a href="https://github.com/BrightcoveLearning/18597-playback-rate-adjuster/tree/master/plugin">插件部分</a>在GitHub倉庫中。</p>
    <aside class="bcls-aside bcls-aside--tip">
      <p>這<strong>videojs-playbackrate-adjuster</strong>中間件已發佈到<strong>npm</strong>並可以包含在您的項目中：<a href="//unpkg.com/videojs-playbackrate-adjuster@1.0.0/dist/browser/videojs-playbackrate-adjuster.min.js"> //unpkg.com/videojs-playbackrate-adjuster@1.0.0/dist/browser/videojs-playbackrate-adjuster.min.js</a></p>
      <p>請注意<strong>unpkg.com</strong>該網站是免費的開放源代碼。它不能保證正常運行時間和基礎架構支持。</p>
    </aside>
  </section>
</article>