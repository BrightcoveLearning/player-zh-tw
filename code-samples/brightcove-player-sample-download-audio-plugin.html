---
title: '布萊特灣球員樣本：下載音頻插件
description: '在本主題中，您將學習如何創建鏈接以允許下載在 Brightcove Player 中播放的音頻資產的最佳質量 MP4。代碼將被編寫和解釋，然後在文檔中轉換成一個插件，以便與不同的玩家一起使用。'
parent: Code Samples
---
 <h1>{{ page.title }}</h1>     
<article class="bcls-article">
  <summary>{{ page.description }}</summary>

  <aside class="bcls-aside bcls-aside--information">本文件中的內容僅適用於視訊雲端。此外，由於 iOS 裝置沒有使用者可存取的檔案系統，因此外掛程式將無法在 iOS 裝置上運作。</aside> 
  <section class="bcls-section">
    <h2 id="Player_example">播放器示例</h2>
    <!-- UPDATE description -->
    
    <aside class="bcls-aside bcls-aside--information">提供此示例和相關代碼作為生產開發的指南。該代碼未經認證可用於生產用途，也未經官方支持。</aside>
    <p>您會看到一個樣式化的Brightcove Player，用於播放音頻資產。單擊播放後，您將在控制欄的右側看到一個下載圖標。單擊此圖標將使音頻資產播放通過瀏覽器下載。</p>
    <p>在視頻中，有一個非常相似的示例使用視頻而不是音頻資產<a href="/code-samples/brightcove-player-sample-download-video-plugin.html">Brightcove Player示例：下載視頻插件</a>文檔。</p>
    <!-- UPDATE codepen here -->
    
    <p class="codepen" data-height="413" data-theme-id="34967" data-default-tab="result" data-user="rcrooks1969" data-slug-hash="QodMJe" style="height: 413px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid black; margin: 1em 0; padding: 1em;" data-pen-title="Download Audio Plugin"><span>看筆<a href="https://codepen.io/team/rcrooks1969/pen/QodMJe/">下載音頻插件</a>通過Brightcove學習服務（<a href="https://codepen.io/rcrooks1969"> @ rcrooks1969</a>） 上<a href="https://codepen.io">密碼筆</a>。</span></p>
    <script async src="https://static.codepen.io/assets/embed/ei.js"></script><!-- UPDATE link to GitHub source -->
    
    <br/>
    <aside class="bcls-aside bcls-aside--tip">瀏覽器下載行為：瀏覽器已經改變了他們處理文件下載的方式。Safari，Firefox和Chrome瀏覽器都會在新窗口或新標籤頁中打開下載的視頻，這通常是不希望的行為。因此，本示例使用客戶端JavaScript工具強制瀏覽器正確下載視頻。有關該工具的詳細信息，請參閱<a href="https://www.npmjs.com/package/downloadjs">https://www.npmjs.com/package/downloadjs</a> .
    
    <h3>源代碼</h3>
          <p>觀看<a href="https://github.com/BrightcoveLearning/18743-download-audio-plugin">GitHub上的完整解決方案</a>。</p>
  </section>
  <section class="bcls-section">
    <details>
      <summary><h2 id="Using_the_CodePen">使用代碼筆</h2></summary>
      <p>以下是一些有效使用上述 CodePen 的提示：</p>
      <ul>
        <li>通過單擊切換播放器的實際顯示<strong translate="No">結果</strong>按鈕。</li>
        <li>點擊<strong translate="No">HTML/CSS/JS</strong>按鈕以顯示其中一種代碼類型。</li>
        <li>在本文檔的後面部分，應用程序中使用的邏輯、流程和样式將在<a href="#Player/HTML_configuration">播放器/HTML 配置</a> , <a href="#Application_flow">申請流程</a>和<a href="#Application_styling">應用樣式</a>部分。遵循這些部分中的信息的最佳方法是：
          <ol>
            <li>點擊<strong translate="No">在 CODEPEN 上編輯</strong> CodePen 中的按鈕，並在一個瀏覽器/瀏覽器選項卡中提供代碼。</li>
            <li>在CodePen中，調整要顯示的代碼。您可以在CodePen中更改不同代碼段的寬度。</li>
            <li>觀看<a href="#Player/HTML_configuration">播放器/ HTML配置</a>，<a href="#Application_flow">申請流程</a>和/或<a href="#Application_styling">應用程式樣式</a>其他瀏覽器/瀏覽器標籤中的部分。現在，您將能夠按照代碼說明進行操作，同時查看代碼。</li>
          </ol>
        </li>
      </ul>
    </details>
  </section>
  <section class="bcls-section">
    <details>
      <summary><h2 id="Development_sequence">開發順序</h2></summary> 
      <p>這是推薦的開發順序：</p>
      <ol>
        <li>使用頁內嵌入播放器實現來測試播放器，插件和CSS的功能（如果需要CSS）</li>
        <li>將插件的JavaScript和CSS放入單獨的文件中以進行本地測試</li>
        <li>解決任何錯誤後，將插件代碼和CSS部署到服務器上</li>
        <li>使用Studio將插件和CSS添加到播放器</li>
        <li>如果您確定iframe實現更合適，請替換頁內嵌入播放器實現（在下一部分中詳細介紹）</li>
      </ol>
      <p>有關這些步驟的詳細信息，請查看<a href="/coding-topics/step-step-plugin-development.html">一步步：插件開發</a>指導。</p>
      <h3>iframe或頁內嵌入</h3>
      <p>在開發Brightcove Player的增強功能時，您需要確定代碼是否最適合iframe或頁內嵌入實施。最佳實踐建議是構建一個可與iframe實現配合使用的插件。使用iframe播放器的優點是：</p>
      <ul>
        <li>與現有的JavaScript和/或CSS無衝突</li>
        <li>自動響應</li>
        <li>iframe可簡化在社交媒體應用中的使用（或需要將視頻“傳播"到其他應用中的任何時候）</li>
      </ul>
      <p>儘管集成頁內嵌入播放器可能會更加複雜，但是有時您會圍繞該實現計劃代碼。概括地說，當包含頁面需要與播放器進行通信時，這種方法是最好的。具體來說，以下是一些示例：</p>
      <ul>
        <li>包含頁面中的代碼需要偵聽播放器事件並對其進行操作</li>
        <li>播放器使用包含頁面中的樣式</li>
        <li>iframe將導致應用邏輯失敗，例如從包含頁面的重定向</li>
      </ul>
      <p>即使最終實現未使用iframe代碼，您仍可以將頁內嵌入代碼與JavaScript插件和CSS單獨文件一起使用。這封裝了你的邏輯，以便您可以輕鬆地在多個玩家中使用它。</p>
    </details>
  </section>
  <section class="bcls-section">
    <h2 id="API/Plugin_resources_used">使用的API /插件資源</h2>
    <!-- UPDATE table, remove unneeded columns -->
    
    <table class="bcls-table">
      <thead class="bcls-table__head">
        <tr>
          <th>API方法</th>
          <th>API事件</th>
          <th>API屬性</th>
        </tr>
      </thead>
      <tbody class="bcls-table__body">
        <tr>
          <td><a href="https://docs.brightcove.com/brightcove-player/current-release/module-events.html#.on"><code translate="No">on()</code></a></td>
          <td><a href="https://docs.brightcove.com/brightcove-player/current-release/Player.html#event:loadstart"><code translate="No">loadstart</code></a></td>
          <td><a href="/references/video-metadata-mediainfo.html"><code translate="No">player.mediainfo</code></a></td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>&nbsp;</td>
          <td><a href="https://docs.brightcove.com/brightcove-player/current-release/CustomControlSpacer.html"><code translate="No">player.controlBar.customControlSpacer</code></a></td>
        </tr>
      </tbody>
    </table>
    <!-- <aside class="bcls-aside bcls-aside--tip">This code sample uses one of the Brightcove REST APIs. To understand working with this API it is vital you read and understand the <a href="/getting-started/learning-guide-using-rest-apis.html">Learning Guide: Using the REST APIs</a> document.</aside> --></section>
  <!-- UPDATE player and HTML configuration -->
  
  <section class="bcls-section">
    <h2 id="Player/HTML_configuration">播放器/ HTML配置</h2>
    <p>本節詳細介紹了播放器創建過程中所需的任何特殊配置。此外，還介紹了除頁面內嵌入播放器實現代碼外，還必須添加到頁面的其他HTML元素。</p>
    <h3>播放程式組態</h3>
    <p>您為此示例創建的Brightcove Player不需要任何特殊配置。</p>
    <h3>其他HTML</h3>
    <p>沒有其他HTML元素添加到頁面。</p>
  </section>
  <!-- UPDATE application flow -->
  
  <section class="bcls-section">
    <h2 id="Application_flow">申請流程</h2>
    <p>此應用程序背後的基本邏輯是：</p>
    <ul>
      <li>獲取音頻資產名稱，並從源數組中提取MP4格式。</li>
      <li>循環播放所有演繹並提取MP4版本。</li>
      <li>對MP4陣列進行排序<code translate="No">size</code>屬性，從大到小。</li>
      <li>將最大表示形式分配給變量。</li>
      <li>創建一個可點擊的圖像，將其下載到HTML內<code translate="No">div</code>元素。</li>
      <li>將下載資產圖像元素放置在DOM中。</li>
    </ul>
    <!-- UPDATE task 1 -->
    
    <h3>獲取音頻資產名稱，並從源數組中提取MP4再現</h3>
    <p>找到標有以下代碼的代碼：</p>
    <pre>
<code class="language-javascript" translate="No">// ### Get video name and the MP4 renditions ###</code></pre>
    <p>首先<code translate="No">videoName</code>變量被分配了視頻的名稱&nbsp;（已刪除空格）以供稍後在代碼中動態構建的HTML錨標記中使用。接下來的<code translate="No">renditionsAra</code>為變量分配了視頻的所有可能再現。</p>
    <p>當然，要使該插件正常運行，您的源代碼中必須至少有一個MP4副本。</p>
    <!-- UPDATE task 2 -->
    
    <h3>循環播放所有視頻片段並提取MP4版本</h3>
    <p>找到標有以下代碼的代碼：</p>
    <pre>
<code class="language-javascript" translate="No">// ### Loop over videos and extract only MP4 versions ###</code></pre>
    <p>遍歷數組並分配給<code translate="No">mp4Ara</code>可變格式，其中<code translate="No">container</code>是<strong>MP4</strong>，並且演繹有一個<code translate="No">src</code>財產。MP4演繹在音樂播放器中出現兩次<code translate="No">sources</code>數組，一次帶有<code translate="No">src</code>財產，一次<code translate="No">stream_name</code>財產。第一個用於漸進式下載，第二個用於流式傳輸。</p>
    <p>以下屏幕快照顯示了控制台，其中顯示了所有演繹，然後顯示了過濾後的演繹，顯示在MP4演繹中。</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="All renditions" src="/assets/images/code-samples/brightcove-player-sample-download-audio-plugin/console-all-renditions.png" />
      <figcaption class="bcls-caption--image">所有演繹</figcaption>
    </figure>
    <figure class="bcls-figure"><img class="bcls-image" alt="Only MP4 renditions after filtering" src="/assets/images/code-samples/brightcove-player-sample-download-audio-plugin/console-mp4-renditions-only.png" />
      <figcaption class="bcls-caption--image">過濾後僅MP4複製</figcaption>
    </figure>
    <!-- UPDATE task 3 -->
    
    <h3>對MP4陣列進行排序<code translate="No">size</code>屬性，從最大到最小</h3>
    <p>找到標有以下代碼的代碼：</p>
    <pre>
<code class="language-javascript" translate="No">// ### Sort the renditions from highest to lowest on size ###</code></pre>
    <p>排序<code translate="No">mp4Ara</code>使用JavaScript的<code translate="No">sort()</code>方法</p>
    <!-- UPDATE task 3 -->
    
    <h3>將最大的視頻分配給變量</h3>
    <p>找到標有以下代碼的代碼：</p>
    <pre>
<code class="language-javascript" translate="No">// ### Extract the highest rendition ###</code></pre>
    <p>分配<code translate="No">highestQuality</code>從排序的MP4再現數組中變量第零個索引值。</p>
    <!-- UPDATE task 3 -->
    
    <h3>創建一個元素，其中包含HTML內的可點擊圖片<code translate="No">div</code>元素</h3>
    <p>找到標有以下代碼的代碼：</p>
    <pre>
<code class="language-javascript" translate="No">// ### Build the download image element ###</code></pre>
    <p>在JavaScript代碼HTML的頂部<code translate="No">div</code>和<code translate="No">img</code>元素被創建並存儲在變量中。然後操縱這些元素以動態構建充當下載按鈕的HTML元素。動態創建的元素可能如何顯示的示例如下：</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="dynamically built download element" src="/assets/images/code-samples/brightcove-player-sample-download-audio-plugin/download-element.png" /></figure>
    <!-- UPDATE task 3 -->
    
    <h3>將下載按鈕元素放置在DOM中</h3>
    <p>找到標有以下代碼的代碼：</p>
    <pre>
<code class="language-javascript" translate="No">// ### Place the download button ###</code></pre>
    <p>在這種情況下，下載按鈕將放置在控制欄的間隔中。首先，獲取對分隔符元素的引用，然後定義設置為將新元素放置在分隔符中的屬性，最後將新元素放置在分隔符中。</p>
  </section>
  <!-- UPDATE CSS description -->
  
  <section class="bcls-section">
    <h2 id="Application_styling">應用程式樣式</h2>
    <p>CSS做兩項工作，它們是：</p>
    <ul>
      <li>為播放器設置樣式，使其具有“僅音頻"外觀。</li>
      <li>調整大小和放置下載按鈕的位置，以將其放置在控制欄中。</li>
    </ul>
  </section>
  <section class="bcls-section">
    <h2 id="Plugin_code">插件代碼</h2>
    <p>通常，將JavaScript轉換為Brightcove Player插件時，需要進行名義上的更改。一項必需的更改是替換標準的使用<code translate="No">ready()</code>方法與定義插件的代碼。</p>
    <p>這是可以與播放器一起使用的非常常用的JavaScript代碼開始：</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.getPlayer('myPlayerID').ready(function() {
  var myPlayer = this;
  ...
});</code></pre>
    <p>您將更改第一行以使用標準語法來啟動Brightcove Player插件：</p>
    <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.registerPlugin('pluginName', function(options) {
  var myPlayer = this;
  ...
});</code></pre>
    <!-- UPDATE path to plugin's JavaScript -->
    
    <aside class="bcls-aside bcls-aside--tip">由於該插件不適用於 iOS，您可能希望將此代碼添加到插件中以防止插件甚至嘗試在 iOS 上下載：
      <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.registerPlugin('downloadVideo', function() {
  if (videojs.browser.IS_IOS) {
    return;
  }

  // rest of the plugin...
});</code></pre>
    </aside>
    <p>如前所述，您可以在該文檔的相應GitHub存儲庫中看到該插件的JavaScript代碼：<a href="https://github.com/BrightcoveLearning/18743-download-audio-plugin/blob/master/plugin/download-audio.js">下載audio.js</a>。</p>
    <h3>與播放器一起使用插件</h3>
    <p>將插件的CSS和JavaScript文件存儲在Internet上可訪問的位置後，即可將其與播放器一起使用。在工作室的<strong>球員</strong>模塊你可以選擇一個播放器，然後在<strong>插件</strong>部分將 URL 添加到 CSS 和 JavaScript 文件，並添加<strong>姓名</strong>和<strong>選項</strong> , 如果需要選項。</p>
    <aside class="bcls-aside bcls-aside--tip">有關使用 Studio 為玩家分配插件的更多信息，請參閱<a href="https://studio.support.brightcove.com/players/configuring-player-plugins.html">配置播放器插件</a>文檔。</aside>
  </section>
  <section class="bcls-section">
    <h2 id="Version_5_backwards_compatibility">版本5向後兼容</h2>
    <p>如果您希望該插件可同時用於版本5和版本6，則必須對JavaScript進行一些更改。將列出更改，然後顯示JavaScript的框架。</p>
    <ol>
      <li>在JavaScript文件頂部添加以下變量聲明。變量定義瞭如何註冊版本5和版本6的插件：
        <pre class="line-numbers">
<code class="language-javascript" translate="No">var registerPlugin = videojs.registerPlugin || videojs.plugin;</code></pre>
      </li>
      <li>將JavaScript的第一行更改為：
        <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.getPlayer('myPlayerID').ready(function() {</code></pre>
        到
        <pre class="line-numbers">
<code class="language-javascript" translate="No">registerPlugin("downloadAudio", function() {</code></pre>
      </li>
      <li>在所有現有代碼下面創建一個函數，以調用現在定義的插件：
        <pre class="line-numbers">
<code class="language-javascript" translate="No">videojs.getPlayer('myPlayerID').ready(function() {
  var player = this;
  player.downloadAudio();
});</code></pre>
      </li>
      <li>檢查以確保代碼結構如下所示：
        <pre class="line-numbers">
<code class="language-javascript" translate="No">var registerPlugin = videojs.registerPlugin || videojs.plugin;

registerPlugin("downloadAudio", function() {
  // Create variables and new div, anchor and image for download icon
  var myPlayer = this,
    videoName,
    totalRenditions,
    mp4Ara = [],
    highestQuality,
    spacer,
    newElement = document.createElement("div"),
    newImage = document.createElement("img");

    // REST OF JavaScript
    ...
});

videojs.getPlayer('myPlayerID').ready(function() {
  var player = this;
  player.downloadAudio();
});</code></pre>
      </li>
    </ol>
  </section>
</article>