---
title:域限制消息
parent: Troubleshooting
description: In this topic, you will learn how to display appropriate error messages when a video is not allowed to play because of domain restrictions. By default, Brightcove Player does not inform the user that a video is domain restricted.
---

<article class="bcls-article">
  <h1>域限制消息</h1>
  <summary>{{ page.description }}</summary>
  <section class="bcls-section">
    <h2 id="Overview">概述</h2>
    <p>可以通過域限制來限制可以觀看視頻的位置。這<a href="https://studio.support.brightcove.com/players/configuring-player-content-restrictions.html">配置播放器內容限制</a>本文檔介紹瞭如何使用Video Cloud來應用域限制。您正在閱讀的文檔將指導您如何實施代碼，以通知用戶播放器正在使用域限制。</p>
    <p>默認情況下，Brightcove Player不會通知用戶他們試圖觀看的視頻在域受限的播放器中。播放器僅顯示黑屏。如果您查看控制台，則會看到以下內容。</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="domain restriction console error" src="/assets/images/troubleshooting/domain-restrictions-error-console.png" /></figure>
    <p>這不是很有幫助，但是如果您檢查<strong>網絡</strong>標籤，然後點擊<strong>名稱</strong>與您的視頻ID相對應的內容，然後檢查<strong>預習</strong>標籤上，您將看到一個更加啟發性的錯誤。</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="domain message console network tab" src="/assets/images/troubleshooting/domain-restrictions-error-network.png" /></figure>
    <p>本文檔實施了一種策略，使用戶知道他們嘗試觀看的視頻受域限制。</p>
  </section>
  <section class="bcls-section">
    <h2 id="errorobject">播放器目錄的錯誤對象</h2>
    <p>創建用戶友好消息的關鍵是<code translate="No">error</code> Brightcove Player的對像中包含的對象<code translate="No">catalog</code>。域限制錯誤的示例在下面的瀏覽器控制台屏幕快照中顯示。請注意，該對象包含一個<code translate="No">data</code>屬性，它本身包含一個數組。該數組將保留目錄在加載視頻時遇到的最後一個錯誤。在示例中，您看到數組中的元素報告了域限制問題。</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="catalog error object" src="/assets/images/troubleshooting/domain-restrictions-catalog-error.png" /></figure>
  </section>
  <section class="bcls-section">
    <h2 id="bccatalogerror">處理BC-catalog錯誤</h2>
    <p>正常情況下可能會處理錯誤<code translate="No">ready()</code>的部分<code translate="No">script</code>阻止可能會導致問題。例如，可能會發生<code translate="No">bc-catalog-error</code>事件可以在播放器準備就緒之前分派，如果您在<code translate="No">ready()</code>部分，您將無法處理該錯誤。您可能會發現代碼中沒有問題，但是該問題可能取決於瀏覽器，因此請謹慎使用。因此，本文檔中的錯誤處理代碼將使用<code translate="No">one()</code>事件處理方法來偵聽<code translate="No">bc-catalog-error</code>在單獨的代碼塊中，而不是在<code translate="No">ready()</code>部分。</p>
  </section>
  <section class="bcls-section">
    <h2 id="htmlmessage">HTML中的消息</h2>
    <p>一旦了解了所產生錯誤的結構及其位置，就可以使用JavaScript為用戶顯示一個描述性錯誤。基本的實現步驟是：</p>
    <ul>
      <li>創建一個在其中顯示消息的目標元素。</li>
      <li>確保玩家已準備好採取行動。</li>
      <li>檢查是否發生任何錯誤。</li>
      <li>如果是，請檢查錯誤是否是域限制問題。</li>
      <li>如果是，則向用戶顯示消息。</li>
    </ul>
    <p>以下代碼實現了這些步驟。</p>
    <ul>
      <li>第 8 行：插入一個HTML元素（在本例中為一個段落），在其中插入文本；給元素一個<code translate="No">id</code>用於定位。</li>
      <li>第13行：使用<code translate="No">one()</code>方法為添加事件監聽器<code translate="No">bc-catalog-error</code>事件僅一次。</li>
      <li>第16行：使用<code translate="No">if</code>語句，以確保發生了一些錯誤。</li>
      <li>第17行：從Brightcove Player目錄的錯誤對像中為變量分配特定的錯誤信息。</li>
      <li>第18行：使用<code translate="No">if</code>語句，以確保存在特定的錯誤信息，並且錯誤類型來自域限制。</li>
      <li>第19行：在第12行創建的HTML元素中插入適當的文本消息。</li>
    </ul>
    <pre class="line-numbers">
<code class="language-html" translate="No">  &lt;video-js id="myPlayerID"
    data-video-id="3495887198001"
    data-account="1507807800001"
    data-player="4c8eb732-ba76-485c-a906-407365721633"
    data-embed="default"
    class="video-js" controls&gt;&lt;/video-js&gt;

    <span class="bcls-highlight">&lt;p id="textTarget"&gt;&lt;/p&gt;</span>

  &lt;script src="https://players.brightcove.net/1507807800001/4c8eb732-ba76-485c-a906-407365721633_default/index.min.js"&gt;&lt;/script&gt;

  &lt;script type="text/javascript"&gt;
    videojs.getPlayer('myPlayerID').<span class="bcls-highlight">one('bc-catalog-error', function(){</span>
      var myPlayer = this,
        specificError;
      <span class="bcls-highlight">if (myPlayer.catalog.error !== undefined) {
        specificError = myPlayer.catalog.error.data[0];
        if (specificError !== undefined &amp; specificError.error_subcode == "DOMAIN") {
          document.getElementById("textTarget").innerHTML = "The video you are trying to watch cannot be viewed as it is domain restricted.";
        };
      };</span>
    });

    videojs.getPlayer('myPlayerID').ready(function() {
      var myPlayer = this;
      console.log('in ready');
    });
  &lt;/script&gt;</code></pre>
    <p>以下屏幕截圖顯示了播放器下方顯示的消息。</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="error below player" src="/assets/images/troubleshooting/domain-restrictions-html-message.png" /></figure>
  </section>
  <section class="bcls-section">
    <h2 id="errorplugin">通過錯誤插件發送消息</h2>
    <p>如果視頻受域限制，則您可能希望在播放器中顯示該消息。您可以使用錯誤插件來執行此操作。錯誤插件會自動加載到播放器中，因此您無需顯式執行該操作。有關錯誤插件的詳細信息，請參見此處。<a href="/plugins/display-error-messages-plugin.html">顯示錯誤消息插件</a>文檔。</p>
    <ul>
      <li>第 43 行：使用<code translate="No">one()</code>方法為添加事件監聽器<code translate="No">bc-catalog-error</code>事件僅一次。</li>
      <li>46-53行：呼叫玩家的<code translate="No">error()</code>方法，傳入定義了<code translate="No">errors</code>要顯示的信息。注意選擇<code translate="No">-3</code>錯誤代碼是任意的，唯一的指導是不要使用標準錯誤代碼（當前為1-5）。</li>
      <li>第57行：致電<code translate="No">error()</code>顯示自定義錯誤信息的方法。用於確定何時出現域限制錯誤的邏輯與上面的相同。作為參數傳遞的對象定義了要顯示的錯誤消息。</li>
    </ul>
    <pre class="line-numbers" data-start="42">
<code class="language-html" translate="No">  &lt;script type="text/javascript"&gt;
    videojs.getPlayer('myPlayerID').<span class="bcls-highlight">one('bc-catalog-error', function(){</span>
      var myPlayer = this,
        specificError;
      <span class="bcls-highlight">myPlayer.errors({
        'errors': {
          '-3': {
            'headline': 'The video you are trying to watch cannot be viewed because of domain restrictions.',
            'type': 'DOMAIN'
          }
        }
      });</span>
      if (typeof(myPlayer.catalog.error) !== 'undefined') {
        specificError = myPlayer.catalog.error.data[0];
        if (specificError !== 'undefined' &amp; specificError.error_subcode == "DOMAIN") {
          <span class="bcls-highlight">myPlayer.error({code:'-3'});</span>
        };
      };
    });

    videojs.getPlayer('myPlayerID').ready(function() {
      var myPlayer = this;
    });
  &lt;/script&gt;</code></pre>
    <p>以下屏幕截圖顯示了錯誤插件顯示的已定義錯誤。</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="defined error" src="/assets/images/troubleshooting/domain-restrictions-errors-plugin.png" /></figure>
  </section>
  <section id="generalerror" class="bcls-section">
    <h2>一般錯誤顯示</h2>
    <p>上面的兩個部分專門處理顯示從受限區域查看地理受限視頻時產生的錯誤。某些錯誤無法提供域限制所提供的詳細信息。此處顯示了此類錯誤對象的示例。請注意<strong>數據</strong>字段為空，而域限制錯誤包含關鍵錯誤信息。</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="general error object" src="/assets/images/troubleshooting/domain-restrictions-general-error.png" /></figure>
    <p>以下代碼顯示瞭如何顯示來自以下位置的信息<code translate="No">catalog.error</code>不論詳細程度如何。在較高級別，代碼執行以下操作：</p>
    <ul>
      <li>檢查是否發生目錄錯誤。</li>
      <li>檢查錯誤對像中是否<code translate="No">data</code>字段包含特定的錯誤信息。如果不是，則將一般錯誤消息注入HTML。</li>
      <li>如果存在特定的錯誤信息，並且與域限制相關，則將適當的消息注入HTML。</li>
      <li>如果存在特定的錯誤信息，並且與域限制無關，則將特定錯誤的消息注入HTML。</li>
    </ul>
    <pre class="line-numbers" data-start="69">
<code class="language-html" translate="No">  &lt;script type="text/javascript"&gt;
    videojs.getPlayer('myPlayerID').one('bc-catalog-error', function(){
      var myPlayer = this,
        specificError;
      if (myPlayer.catalog.error != undefined) {
        specificError = myPlayer.catalog.error.data[0];
        if (specificError == undefined) {
          document.getElementById("textTarget").innerHTML = "The following error has occurred: &lt;strong&gt;" + myPlayer.catalog.error.message + "&lt;/strong&gt;";
        } else if (specificError.error_subcode == "DOMAIN") {
          document.getElementById("textTarget").innerHTML = "The video you are trying to watch cannot be viewed because of domain restrictions.";
        } else {
          document.getElementById("textTarget").innerHTML = "The following error has occurred: " + specificError.message;
        };
      };
    });

    videojs.getPlayer('myPlayerID').ready(function() {
      var myPlayer = this;
    });
  &lt;/script&gt;</code></pre>
    <p>以下屏幕截圖顯示了以HTML顯示的一般錯誤消息。當然，您也可以使用錯誤插件來顯示消息，如本文檔前面的部分所示。</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="general error message display below player" src="/assets/images/troubleshooting/domain-restrictions-general-message.png" /></figure>
  </section>
</article>