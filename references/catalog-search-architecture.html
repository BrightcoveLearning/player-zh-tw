---
title:目錄搜索架構
parent: References
---

<article class="bcls-article">
  <h1>目錄搜索架構</h1>
  <summary>在本主題中，您將了解Brightcove的目錄搜索技術的體系結構。</summary>
  <section class="bcls-section">
    <h2 id="Overview">概述</h2>
    <p >自2019年4月起，目錄搜索功能已升級到Elasticsearch。此升級提供了許多好處，其中主要是提高了相關性和準確性，並顯著提高了性能 - 響應時間更加一致並且通常快兩倍。此新功能將影響 CMS API、播放 API、Studio 交互式搜索和目錄搜索方法。</p>
    <p >雖然 Brightcove 投入了大量精力來使 Elasticsearch 結果保持一致，但還是存在差異，如果您對搜索結果編寫了特定的依賴關係，則您的集成可能不會按預期運行，這種可能性很小。</p>
  </section>
  <section class="bcls-section">
    <h2 id="Search_Result_Differences_and_Impact">搜索結果差異和影響</h2>
    <p >在研究潛在影響時，Brightcove發現超過90％的搜索返回的結果與返回的結果數相匹配。這是一個指標，表明預期結果不應該差異到足以導致 API 集成出現任何問題。</p>
    <figure class="bcls-figure"><img class="bcls-image" alt="comparison" src="/assets/images/references/catalog-search/comparison.png" /></figure>
    <p >此圖以藍色顯示與兩個系統之間的結果數完全匹配的搜索結果數，以紅色顯示數量不同的搜索結果數。</p>
    <p >作為我們推出的一部分，Elasticsearch已經提供了幾個月的所有默認搜索，即對空字符串的搜索，因此用戶已經可以毫無問題地查看和使用Elasticsearch結果。</p>
    <p >然而，我們可以從這種比較中學到的東西是有限的。充其量，我們只能推斷出特定搜索的意圖，並且目錄數據是可變的。</p>
  </section>
  <section class="bcls-section">
    <h2 id="Known_Differences">已知差異</h2>
    <p >下面的差異主要是基本的，或者是在對搜索結果進行廣泛分析後得出的決定的結果——它們不可能完全消除。</p>
    <h3>詞幹</h3>
    <p ><a href="https://en.wikipedia.org/wiki/Stemming">詞幹</a>是將屈折（或有時派生）詞減少到它們的<a href="https://en.wikipedia.org/wiki/Word_stem">詞幹</a> , 基礎或<a href="https://en.wikipedia.org/wiki/Root_(linguistics)">根</a>形式——通常是書面文字形式。</p>
    <p >在詞幹上操作的英語詞幹分析器 <em>貓</em> 應該確定這樣的<a href="https://en.wikipedia.org/wiki/String_literal">字符串</a>作為 <em>貓</em>， <em>貓似的</em> 和 <em>斤</em>.詞幹算法也可能會減少單詞 <em>釣魚</em>， <em>釣魚</em> 和 <em>漁夫</em> 到莖 <em>魚</em>.詞幹不一定是一個詞，例如波特算法減少 <em>爭論</em>， <em>爭論</em>， <em>爭論</em>， <em>爭論</em> 和 <em>阿格斯</em> 到莖 <em>阿古</em>.</p>
    <p >我們現有的搜索使用 Lancaster (Paice/Husk) 詞幹分析器，這種算法通常被認為過於激進——這導致缺乏區分，例如 <em>打火機</em> 和 <em>光</em> 將被視為蘭開斯特統治下的同一術語。</p>
    <p >Elasticsearch使用的是一種更新較新且較不積極的算法（Porter2），該算法已在業界得到廣泛採用，並且通常被認為是一項重大改進（Lancaster現在很少見）。詞幹分析器的變化可能會影響很大（約 35%）的搜索比例：這並不是說結果<strong>將要</strong>不同，只是他們<strong>可能</strong>有所不同——但總的來說，這應該是更好的：也就是說，某些客戶子集可能依賴於舊行為。</p>
    <h3>關聯</h3>
    <p >我們現有的搜索似乎具有更嚴格的TF規範化。這對在較大字段中找到的術語導致不同的相關性排序（即，存在認為匹配不太相關，因為它對術語的權重較小，因為它相對於文檔的長度更小）。</p>
    <h3>特殊的角色</h3>
    <p >特殊字符在我們現有的搜索中被剝離，這幾乎等同於剝離標點符號和相關字符——而不是剝離，我們通常在 Elasticsearch 中對它們進行轉義，因此搜索有可能將它們考慮在內。</p>
    <h3>術語處理</h3>
    <p >現有的搜索查詢會執行“術語欺騙"，而在Elasticsearch中，我們刪除格式錯誤的術語，請將此搜索考慮為空<code translate="No">tags:</code>學期：<code translate="No">q=tags: state:ACTIVE</code></p>
    <ul>
      <li><strong>現存的</strong>：<code translate="No">tags:state:ACTIVE</code>—搜索帶有標記的視頻<code translate="No">state:ACTIVE</code></li>
      <li><strong>彈性搜索</strong>：<code translate="No">state:ACTIVE</code>—刪除空詞</li>
    </ul>
    <p >有許多與處理懸空標點符號和通常格式錯誤的查詢相關的微妙邊緣情況，我們試圖產生我們認為查詢的意圖，但在這些情況下，我們很遺憾地猜測用戶可能有意圖（當我們真的應該返回一個錯誤時，允許他們優化他們的搜索）</p>
    <h3>只能播放</h3>
    <p >有兩種機制可以將搜索限制為當前可播放的視頻：查詢可以包含一個標誌，或者查詢本身可能需要某些方面的可播放性。</p>
    <ul>
      <li>現有：這是根據要更新的字段的值查詢的</li>
      <li>Elasticsearch：這是根據計算的日期範圍查詢的</li>
    </ul>
    <p >Elasticsearch通常應更準確並產生更好的結果（與現有機制相關聯存在滯後，並且標誌維護機制並不完全可靠）。</p>
    <h3>索引準確度</h3>
    <p >Elasticsearch 索引比現有索引“更新鮮”，並且傾向於更快地反映更新——情況並非總是如此，但總體而言，Elasticsearch 的經驗是結果將更準確地反映基礎目錄數據的狀態。現有的和Elasticsearch都是分佈式系統，因此它們返回的結果並不完全一致：對這兩個系統的重複查詢都可能返回不同的結果（尤其是在有多個並發運行的刪除操作的情況下）。</p>
    <p >現有的搜索結果會根據帳戶分配給的分片的狀態而變化-特定分片的全局狀態會（並且確實）影響任何特定查詢的結果：Elasticsearch沒有這種缺陷。</p>
  </section>
  <section class="bcls-section">
    <h2 id="Examples">例子</h2>
    <h3>例子1</h3>
    <p >假設有兩個視頻的標題如下：</p>
    <pre>
  <code class="language-html" translate="No">Video#1: has the title “Don’t look into the light”
  Video#2: has the title “Using a lighter to make a campfire”</code></pre>
    <p >用戶希望返回所有必須帶有“light”字樣的視頻。使用 CMS API，查詢將如下所示：</p>
    <pre>
  <code class="language-html" translate="No">q=%2Blight or q=+light</code></pre>
    <p >使用現有搜索，這將按順序返回兩個視頻：</p>
    <pre>
  <code class="language-html" translate="No">Video#2 - “Using a lighter to make a campfire”
  Video#1 - “Don’t look into the light”</code></pre>
    <p >這有兩個問題：</p>
    <ul>
      <li><strong>關聯</strong>：順序不正確。在“使用打火機做篝火"（視頻＃1）之前應出現“不要直視燈"（視頻＃2）</li>
      <li><strong>準確性</strong>：結果集中甚至不應出現“使用打火機做篝火"，因為視頻標題中根本沒有出現“light"一詞。</li>
    </ul>
    <p >使用 Elasticsearch，這將只返回視頻一：</p>
    <pre>
  <code class="language-html" translate="No">Video#1 - “Don’t look into the light”</code></pre>
    <p >這是一個改進，因為：</p>
    <ul>
      <li>關聯：順序是正確的。</li>
      <li>準確性：僅返回一個視頻，因為它是標題中唯一帶有“light"字樣的視頻。</li>
    </ul>
    <h3>例子2</h3>
    <p >如我們的描述<a href="https://apis.support.brightcove.com/cms/searching/cmsplayback-api-videos-search.html#Stemming">用於阻止的CMS API文檔</a>，支持詞幹搜索，但不支持部分單詞搜索。假設有 5 個視頻具有以下標題：</p>
    <pre>
  <code class="language-html" translate="No">Video#1 - "Parking Ban Announced"
  Video#2 - "Parking to be Banned"
  Video#3 - "City Banning Parking"
  Video#4 - "Bank Holiday"
  Video#5 - "Bandit Captured"</code></pre>
    <p >用戶希望返回所有必須包含該詞的視頻<strong>禁止</strong>在名稱字段中。使用 CMS API，查詢將如下所示：</p>
    <pre>
  <code class="language-html" translate="No">q=%2Bname%3Aban or q=+name:ban</code></pre>
    <p >期望“Ban”、“Banning”和“Banned”會產生搜索結果，因為“Ban”是這三個詞的詞幹。</p>
    <p >但是，在當前的搜索系統中，這將按以下順序返回所有五個視頻：</p>
    <pre>
  <code class="language-html" translate="No">Video#2 - "Parking to be Banned"
  Video#3 - "City Banning Parking"
  Video#1 - "Parking Ban Announced"
  Video#4 - "Bank Holiday"
  Video#5 - "Bandit Captured"</code></pre>
    <p >同樣，這有兩個問題：</p>
    <ul>
      <li>關聯：順序不正確。"Parking Ban Announced" should be the first video returned as it has the word “Ban” in it.</li>
      <li>準確性："Bank Holiday" and "Bandit Captured" should not be returned at all as “Ban” is not part of the word “Bank” or “Bandit”.</li>
    </ul>
    <p >使用 Elasticsearch，結果如下所示：</p>
    <pre>
  <code class="language-html" translate="No">Video#1 - "Parking Ban Announced"
  Video#2 - "Parking to be Banned"
  Video#3 - "City Banning Parking"</code></pre>
    <p >這是一個改進，因為：</p>
    <ul>
      <li>關聯：順序是正確的。</li>
      <li>準確性：僅返回帶有單詞“Ban"（“Ban"，“Banning"和“Banned"）詞幹的視頻。</li>
    </ul>
  </section>
</article>
